import { useTranslation } from "react-i18next";
import { CalendarDays } from "lucide-react";
import ReservationCard from "./ReservationCard";
import ReservationTable from "./ReservationTable";
import EmptyStatePanel from "../../../components/common/organisms/EmptyStatePanel";
import SkeletonLoader from "../../../components/common/molecules/SkeletonLoader";
import TablePagination from "../../../components/common/molecules/TablePagination";

/**
 * ReservationList â€“ renders cards on mobile, table on desktop.
 * Uses CSS-only breakpoint trick: table hidden below md, cards hidden above md.
 */
const ReservationList = ({
  reservations = [],
  resourceMap = {},
  locale,
  loading,
  page,
  totalPages,
  totalCount = 0,
  pageSize = 20,
  busyId,
  focusId,
  onConfirm,
  onMarkPaid,
  onCancel,
  onComplete,
  onPageChange,
  onPageSizeChange,
  sortKey = "checkIn",
  sortDir = "desc",
  onSort,
}) => {
  const { t } = useTranslation();

  if (loading) return <SkeletonLoader className="py-2" />;

  if (reservations.length === 0) {
    return (
      <EmptyStatePanel
        icon={CalendarDays}
        title={t("appReservationsPage.empty")}
        description={t("appReservationsPage.subtitle")}
        compact
      />
    );
  }

  const sharedProps = {
    reservations,
    resourceMap,
    locale,
    busyId,
    focusId,
    onConfirm,
    onMarkPaid,
    onCancel,
    onComplete,
    sortKey,
    sortDir,
    onSort,
  };

  return (
    <div className="space-y-3">
      {/* Mobile cards + pagination */}
      <div className="md:hidden space-y-3">
        <div className="grid gap-3">
          {reservations.map((r) => (
            <ReservationCard
              key={r.$id}
              reservation={r}
              resourceMap={resourceMap}
              locale={locale}
              busyId={busyId}
              onConfirm={(id) => onConfirm(id)}
              onMarkPaid={(id) => onMarkPaid(id)}
              onCancel={(id) => onCancel(id)}
              onComplete={(id) => onComplete(id)}
              isFocused={Boolean(focusId) && r.$id === focusId}
            />
          ))}
        </div>
        <div className="rounded-xl border border-slate-200 bg-white dark:border-slate-700 dark:bg-slate-900">
          <TablePagination
            page={page}
            totalPages={totalPages}
            totalItems={totalCount}
            pageSize={pageSize}
            onPageChange={onPageChange}
            onPageSizeChange={onPageSizeChange}
          />
        </div>
      </div>

      {/* Desktop: unified table + pagination */}
      <div className="hidden md:block min-w-0 rounded-xl border border-slate-200 bg-white dark:border-slate-700 dark:bg-slate-900">
        <ReservationTable {...sharedProps} />
        <TablePagination
          page={page}
          totalPages={totalPages}
          totalItems={totalCount}
          pageSize={pageSize}
          onPageChange={onPageChange}
          onPageSizeChange={onPageSizeChange}
        />
      </div>
    </div>
  );
};

export default ReservationList;
